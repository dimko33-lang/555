<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>–°–¢–û: –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –õ–æ—Ä–µ–Ω—Ü–∞</title>
<style>
  body { margin:0; background:#111; overflow:hidden; touch-action: none; font-family: Arial, sans-serif; }
  canvas { display:block; }
  /* –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è */
  .controls {
    position: absolute;
    top: 10px;
    right: 10px;
    display: flex;
    gap: 8px;
    z-index: 100;
    flex-wrap: wrap;
    justify-content: flex-end;
    max-width: 200px;
  }
  .btn {
    width: 40px;
    height: 40px;
    border-radius: 5px;
    background: rgba(0,0,0,0.7);
    border: 1px solid rgba(255,255,255,0.3);
    color: white;
    font-size: 20px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    user-select: none;
    transition: all 0.2s;
  }
  .btn:hover {
    background: rgba(50,50,50,0.9);
  }
  .btn:active {
    transform: scale(0.95);
  }
  /* –ü–∞–Ω–µ–ª—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ */
  .info-panel {
    position: absolute;
    top: 10px;
    left: 10px;
    background: rgba(0,0,0,0.7);
    color: white;
    padding: 12px 15px;
    border-radius: 5px;
    font-size: 14px;
    border: 1px solid rgba(255,255,255,0.2);
    z-index: 100;
    min-width: 180px;
  }
  .info-title {
    color: #0ff;
    font-weight: bold;
    margin-bottom: 8px;
    font-size: 16px;
  }
  .info-item {
    margin: 5px 0;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  .info-label {
    color: #aaa;
  }
  .info-value {
    font-weight: bold;
    font-family: 'Courier New', monospace;
  }
  .speed-value {
    color: #fa0;
    font-size: 16px;
  }
  
  /* –°—Ç–∏–ª–∏ –¥–ª—è —Å–≤–µ—Ç–ª–æ–≥–æ —Ä–µ–∂–∏–º–∞ */
  body.light-mode {
    background: #fff;
  }
  body.light-mode .btn {
    background: rgba(255,255,255,0.7);
    border: 1px solid rgba(0,0,0,0.3);
    color: #000;
  }
  body.light-mode .info-panel {
    background: rgba(255,255,255,0.9);
    color: #000;
    border: 1px solid rgba(0,0,0,0.2);
  }
  body.light-mode .info-label {
    color: #666;
  }
  body.light-mode .info-title {
    color: #08f;
  }
</style>
</head>
<body>
<canvas id="c"></canvas>

<!-- –ü–∞–Ω–µ–ª—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ -->
<div class="info-panel" id="infoPanel">
  <div class="info-title">–°–¢–û: –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –õ–æ—Ä–µ–Ω—Ü–∞</div>
  <div class="info-item">
    <span class="info-label">–°–∫–æ—Ä–æ—Å—Ç—å:</span>
    <span class="info-value speed-value" id="speedValue">0.0% c</span>
  </div>
  <div class="info-item">
    <span class="info-label">Œ≥ (–≥–∞–º–º–∞):</span>
    <span class="info-value" id="gammaValue">1.000</span>
  </div>
  <div class="info-item">
    <span class="info-label">–ë—ã—Å—Ç—Ä–æ—Ç–∞:</span>
    <span class="info-value" id="rapidityValue">0.000</span>
  </div>
</div>

<!-- –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
<div class="controls">
  <button class="btn" id="negBtn" title="–ù–µ–≥–∞—Ç–∏–≤/–ò–Ω–≤–µ—Ä—Å–∏—è">‚òÄ</button>
  <button class="btn" id="fullscreen" title="–ü–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º">‚õ∂</button>
</div>

<script>
const canvas = document.getElementById("c");
const ctx = canvas.getContext("2d");

let rapidity = 0; // –ë–´–°–¢–†–û–¢–ê (–≤ –°–¢–û –≤–º–µ—Å—Ç–æ —É–≥–ª–∞)
let dragging = false;
let lastX = 0;
let darkMode = true;

// –ü–ê–†–ê–ú–ï–¢–†–´
const numLines = 11;
const secondsPerSide = 5;
const vertLineLength = 3000;

// –†–ê–°–ß–ï–¢ –†–ê–°–°–¢–û–Ø–ù–ò–ô
const lineSpacing = vertLineLength / (numLines - 1);
const halfSpacing = lineSpacing / 2;
const smallSpacing = lineSpacing / 10;

// drag
canvas.addEventListener("pointerdown", e => {
  dragging = true;
  lastX = e.clientX;
});

canvas.addEventListener("pointermove", e => {
  if(dragging){
    const dx = e.clientX - lastX;
    rapidity -= dx * 0.01;
    // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –±—ã—Å—Ç—Ä–æ—Ç—É (—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç v < 0.999c)
    rapidity = Math.max(-3, Math.min(3, rapidity));
    lastX = e.clientX;
    updateInfo();
  }
});

canvas.addEventListener("pointerup", e => dragging = false);
canvas.addEventListener("pointerleave", e => dragging = false);

// –ö–Ω–æ–ø–∫–∞ –Ω–µ–≥–∞—Ç–∏–≤–∞/—Å–≤–µ—Ç–ª–æ–≥–æ —Ä–µ–∂–∏–º–∞
document.getElementById('negBtn').addEventListener('click', () => {
  darkMode = !darkMode;
  document.body.classList.toggle('light-mode', !darkMode);
  document.getElementById('negBtn').textContent = darkMode ? '‚òÄ' : 'üåô';
});

// –ü–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º
document.getElementById('fullscreen').addEventListener('click', () => {
  if (!document.fullscreenElement) {
    document.documentElement.requestFullscreen().catch(err => {
      console.error(`–û—à–∏–±–∫–∞ –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞: ${err.message}`);
    });
  } else {
    document.exitFullscreen();
  }
});

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ (–ü–†–ê–í–ò–õ–¨–ù–û –¥–ª—è –°–¢–û!)
function updateInfo() {
  // –í –°–¢–û: v/c = tanh(rapidity), Œ≥ = cosh(rapidity)
  const velocity = Math.tanh(rapidity); // v/c –æ—Ç -1 –¥–æ 1
  const velocityPercent = (Math.abs(velocity) * 100).toFixed(1);
  const gamma = Math.cosh(rapidity); // Œ≥ ‚â• 1
  
  // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∑–Ω–∞–∫ —Å–∫–æ—Ä–æ—Å—Ç–∏
  const sign = velocity >= 0 ? '+' : '-';
  
  document.getElementById('speedValue').textContent = `${sign}${velocityPercent}% c`;
  document.getElementById('gammaValue').textContent = gamma.toFixed(3);
  document.getElementById('rapidityValue').textContent = rapidity.toFixed(3);
  
  // –¶–≤–µ—Ç —Å–∫–æ—Ä–æ—Å—Ç–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤–µ–ª–∏—á–∏–Ω—ã
  const speedValue = document.getElementById('speedValue');
  const absV = Math.abs(velocity);
  if (absV < 0.3) {
    speedValue.style.color = darkMode ? '#0f0' : '#080';
  } else if (absV < 0.7) {
    speedValue.style.color = darkMode ? '#ff0' : '#880';
  } else if (absV < 0.95) {
    speedValue.style.color = darkMode ? '#f80' : '#c60';
  } else {
    speedValue.style.color = darkMode ? '#f00' : '#c00';
  }
}

function resize() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
window.addEventListener("resize", resize);
resize();

// –§—É–Ω–∫—Ü–∏—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –º–∏—Ä–æ–≤—ã—Ö –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –≤ —ç–∫—Ä–∞–Ω–Ω—ã–µ
function toScreen(x, y) {
  // –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ–º –∫—Ä–µ—Å—Ç –Ω–∞ —ç–∫—Ä–∞–Ω–µ
  return {
    x: x + canvas.width/2,
    y: y + canvas.height/2
  };
}

// –§—É–Ω–∫—Ü–∏—è –≤—ã–±–æ—Ä–∞ —Ü–≤–µ—Ç–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–µ–∂–∏–º–∞
function getColor(darkColor, lightColor) {
  return darkMode ? darkColor : lightColor;
}

// –§—É–Ω–∫—Ü–∏—è —Ä–∏—Å–æ–≤–∞–Ω–∏—è –ª–∏–Ω–∏–∏
function drawLine(x1, y1, x2, y2, darkColor, lightColor, width) {
  const p1 = toScreen(x1, y1);
  const p2 = toScreen(x2, y2);
  
  ctx.strokeStyle = getColor(darkColor, lightColor);
  ctx.lineWidth = width;
  ctx.beginPath();
  ctx.moveTo(p1.x, p1.y);
  ctx.lineTo(p2.x, p2.y);
  ctx.stroke();
}

// –§—É–Ω–∫—Ü–∏—è —Ä–∏—Å–æ–≤–∞–Ω–∏—è –æ—Ç–º–µ—Ç–∫–∏
function drawMark(px, py, dirX, dirY, length, darkColor, lightColor, width, style = "solid") {
  const p = toScreen(px, py);
  const d = toScreen(px + dirX * length/2, py + dirY * length/2);
  const d2 = toScreen(px - dirX * length/2, py - dirY * length/2);
  
  ctx.strokeStyle = getColor(darkColor, lightColor);
  ctx.lineWidth = width;
  
  if (style === "dashed") {
    ctx.setLineDash([3, 2]);
  } else {
    ctx.setLineDash([]);
  }
  
  ctx.beginPath();
  ctx.moveTo(d2.x, d2.y);
  ctx.lineTo(d.x, d.y);
  ctx.stroke();
  
  ctx.setLineDash([]);
}

// –§—É–Ω–∫—Ü–∏—è —Ä–∏—Å–æ–≤–∞–Ω–∏—è —Ç–æ—á–∫–∏
function drawPoint(px, py, radius, darkColor, lightColor) {
  const p = toScreen(px, py);
  ctx.fillStyle = getColor(darkColor, lightColor);
  ctx.beginPath();
  ctx.arc(p.x, p.y, radius, 0, Math.PI * 2);
  ctx.fill();
}

function draw() {
  // –û—á–∏—Å—Ç–∫–∞ —Å —É—á—ë—Ç–æ–º —Ä–µ–∂–∏–º–∞
  if (darkMode) {
    ctx.fillStyle = "#111";
  } else {
    ctx.fillStyle = "#fff";
  }
  ctx.fillRect(0, 0, canvas.width, canvas.height);
  
  const cx = 0; // —Ü–µ–Ω—Ç—Ä –≤ –º–∏—Ä–æ–≤—ã—Ö –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞—Ö
  const cy = 0;

  // –í –°–¢–û –∏—Å–ø–æ–ª—å–∑—É–µ–º –≥–∏–ø–µ—Ä–±–æ–ª–∏—á–µ—Å–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏!
  const cosh = Math.cosh(rapidity);
  const sinh = Math.sinh(rapidity);

  // --- –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–∞—è –æ—Å—å (–ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞) ---
  drawLine(-vertLineLength/2, cy, vertLineLength/2, cy, "#888", "#666", 2);

  // –∫—Ä–µ—Å—Ç ct‚Ä≤ + x‚Ä≤ (–¥–≤–∏–∂—É—â–∞—è—Å—è —Å–∏—Å—Ç–µ–º–∞)
  const ctX0 = cx - sinh * vertLineLength/2;
  const ctY0 = cy - cosh * vertLineLength/2;
  const ctX1 = cx + sinh * vertLineLength/2;
  const ctY1 = cy + cosh * vertLineLength/2;

  const xX0 = cx - cosh * vertLineLength/2;
  const xY0 = cy + sinh * vertLineLength/2;
  const xX1 = cx + cosh * vertLineLength/2;
  const xY1 = cy - sinh * vertLineLength/2;

  // ct‚Ä≤ (–≥–æ–ª—É–±–∞—è)
  drawLine(ctX0, ctY0, ctX1, ctY1, "#0ff", "#08f", 1);

  // x‚Ä≤ (–æ—Ä–∞–Ω–∂–µ–≤–∞—è)
  drawLine(xX0, xY0, xX1, xY1, "#fa0", "#c60", 1);

  // –í–ï–ö–¢–û–†–´ –î–õ–Ø –û–°–ï–ô
  const ctDirX = ctX1 - ctX0;
  const ctDirY = ctY1 - ctY0;
  const ctLength = Math.sqrt(ctDirX*ctDirX + ctDirY*ctDirY);
  const ctUnitX = ctDirX / ctLength;
  const ctUnitY = ctDirY / ctLength;
  const ctPerpX = -ctUnitY;
  const ctPerpY = ctUnitX;
  
  const xDirX = xX1 - xX0;
  const xDirY = xY1 - xY0;
  const xLength = Math.sqrt(xDirX*xDirX + xDirY*xDirY);
  const xUnitX = xDirX / xLength;
  const xUnitY = xDirY / xLength;
  const xPerpX = -xUnitY;
  const xPerpY = xUnitX;
  
  // –û–¢–ú–ï–¢–ö–ò –ù–ê –ì–û–õ–£–ë–û–ô –û–°–ò (ct‚Ä≤)
  for(let sec = 1; sec <= secondsPerSide; sec++) {
    const distance = sec * lineSpacing;
    
    // –ë–û–õ–¨–®–ò–ï –û–¢–ú–ï–¢–ö–ò (1.0 —Å–µ–∫)
    const bigX1 = distance * ctUnitX;
    const bigY1 = distance * ctUnitY;
    drawMark(bigX1, bigY1, ctPerpX, ctPerpY, 14, "#0ff", "#08f", 1.5);
    
    const bigX2 = -distance * ctUnitX;
    const bigY2 = -distance * ctUnitY;
    drawMark(bigX2, bigY2, ctPerpX, ctPerpY, 14, "#0ff", "#08f", 1.5);
    
    // –û–¢–ú–ï–¢–ö–ò 0.5 —Å–µ–∫
    const halfDistance = distance - halfSpacing;
    const halfX1 = halfDistance * ctUnitX;
    const halfY1 = halfDistance * ctUnitY;
    drawMark(halfX1, halfY1, ctPerpX, ctPerpY, 10, "#0aa", "#06a", 1.0, "dashed");
    
    const halfX2 = -halfDistance * ctUnitX;
    const halfY2 = -halfDistance * ctUnitY;
    drawMark(halfX2, halfY2, ctPerpX, ctPerpY, 10, "#0aa", "#06a", 1.0, "dashed");
  }
  
  // –ú–ï–õ–ö–ò–ï –û–¢–ú–ï–¢–ö–ò (0.1 —Å–µ–∫) –ù–ê –ì–û–õ–£–ë–û–ô –û–°–ò
  const smallMarksPerSide = secondsPerSide * 10;
  for(let tenth = 1; tenth <= smallMarksPerSide; tenth++) {
    if (tenth % 5 === 0 || tenth % 10 === 0) continue;
    
    const distance = tenth * smallSpacing;
    const smallX1 = distance * ctUnitX;
    const smallY1 = distance * ctUnitY;
    
    drawPoint(smallX1, smallY1, 2, "#099", "#057");
    
    const smallX2 = -distance * ctUnitX;
    const smallY2 = -distance * ctUnitY;
    drawPoint(smallX2, smallY2, 2, "#099", "#057");
  }

  // –í–ï–†–¢–ò–ö–ê–õ–¨–ù–´–ï –õ–ò–ù–ò–ò
  for(let i=-Math.floor(numLines/2); i<=Math.floor(numLines/2); i++){
    const t = i / Math.floor(numLines/2); 
    const px = xX0 + (xX1 - xX0)*(0.5 + t/2); 
    const py = xY0 + (xY1 - xY0)*(0.5 + t/2);
    
    // –í–µ–∫—Ç–æ—Ä –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–π –ª–∏–Ω–∏–∏ (–ø–µ—Ä–ø–µ–Ω–¥–∏–∫—É–ª—è—Ä–Ω–æ x‚Ä≤ –≤ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ –ú–∏–Ω–∫–æ–≤—Å–∫–æ–≥–æ)
    // –í –°–¢–û: –ø–µ—Ä–ø–µ–Ω–¥–∏–∫—É–ª—è—Ä –∫ x‚Ä≤ —ç—Ç–æ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ ct‚Ä≤
    const vertDx = -sinh;
    const vertDy = cosh;
    
    // –†–∏—Å—É–µ–º –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—É—é –ª–∏–Ω–∏—é
    drawLine(
      px - vertDx * vertLineLength/2, 
      py - vertDy * vertLineLength/2,
      px + vertDx * vertLineLength/2, 
      py + vertDy * vertLineLength/2,
      "#880", "#660", 
      1
    );
    
    // –í–µ–∫—Ç–æ—Ä –¥–ª—è –æ—Ç–º–µ—Ç–æ–∫ (–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ x‚Ä≤)
    const markDx = cosh;
    const markDy = sinh;
    
    // –û–¢–ú–ï–¢–ö–ò –ù–ê –í–ï–†–¢–ò–ö–ê–õ–¨–ù–´–• –õ–ò–ù–ò–Ø–•
    for(let sec = 1; sec <= secondsPerSide; sec++) {
      const distance = sec * lineSpacing;
      
      // –ë–û–õ–¨–®–ò–ï –û–¢–ú–ï–¢–ö–ò (1.0 —Å–µ–∫)
      const upX = px - vertDx * distance;
      const upY = py - vertDy * distance;
      drawMark(upX, upY, markDx, markDy, 12, "#fa0", "#c60", 1.5);
      
      const downX = px + vertDx * distance;
      const downY = py + vertDy * distance;
      drawMark(downX, downY, markDx, markDy, 12, "#fa0", "#c60", 1.5);
      
      // –û–¢–ú–ï–¢–ö–ò 0.5 —Å–µ–∫
      const halfDistance = distance - halfSpacing;
      const halfUpX = px - vertDx * halfDistance;
      const halfUpY = py - vertDy * halfDistance;
      drawMark(halfUpX, halfUpY, markDx, markDy, 9, "#c80", "#a50", 1.0, "dashed");
      
      const halfDownX = px + vertDx * halfDistance;
      const halfDownY = py + vertDy * halfDistance;
      drawMark(halfDownX, halfDownY, markDx, markDy, 9, "#c80", "#a50", 1.0, "dashed");
    }
    
    // –ú–ï–õ–ö–ò–ï –û–¢–ú–ï–¢–ö–ò (0.1 —Å–µ–∫) –ù–ê –í–ï–†–¢–ò–ö–ê–õ–¨–ù–´–• –õ–ò–ù–ò–Ø–•
    for(let tenth = 1; tenth <= secondsPerSide * 10; tenth++) {
      if (tenth % 5 === 0 || tenth % 10 === 0) continue;
      
      const distance = tenth * smallSpacing;
      const upX = px - vertDx * distance;
      const upY = py - vertDy * distance;
      
      drawPoint(upX, upY, 1.5, "#880", "#440");
      
      const downX = px + vertDx * distance;
      const downY = py + vertDy * distance;
      drawPoint(downX, downY, 1.5, "#880", "#440");
    }
  }

  // –¶–µ–Ω—Ç—Ä –∫—Ä–µ—Å—Ç–∞
  const center = toScreen(0, 0);
  ctx.fillStyle = getColor("#fff", "#000");
  ctx.beginPath();
  ctx.arc(center.x, center.y, 4, 0, Math.PI * 2);
  ctx.fill();

  requestAnimationFrame(draw);
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
updateInfo();
draw();
</script>
</body>
  </html>
