<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>SR Visualization</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<style>
body { 
  margin:0; 
  background:#000833; 
  overflow:hidden; 
  touch-action: none; 
  font-family: Arial, sans-serif;
}
canvas { 
  display:block;
  position: absolute;
  top: 0;
  left: 0;
  z-index: 1;
}

/* –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤ —Ä—è–¥ */
.controls {
  position: fixed;
  top: 10px;
  right: 10px;
  display: flex;
  gap: 6px;
  flex-wrap: nowrap;
  justify-content: flex-end;
  max-width: 220px;
  z-index: 100;
}
.btn {
  width: 44px;
  height: 44px;
  border-radius: 5px;
  background: rgba(0,0,0,0.7);
  border: 1px solid rgba(255,255,255,0.3);
  color: white;
  font-size: 18px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  user-select: none;
  transition: all 0.2s;
  flex-shrink: 0;
}
.btn:hover { background: rgba(50,50,50,0.9); }
.btn:active { transform: scale(0.95); }

/* –ü–∞–Ω–µ–ª—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ */
.info-panel {
  position: fixed;
  top: 10px;
  left: 10px;
  background: rgba(0,0,0,0.7);
  color: white;
  padding: 0 15px;
  border-radius: 5px;
  font-size: 14px;
  border: 1px solid rgba(255,255,255,0.2);
  min-width: 200px;
  height: 44px;
  z-index: 100;
  display: flex;
  flex-direction: column;
  justify-content: center;
}
.info-item { margin: 0; display: flex; justify-content: space-between; align-items: center; }
.info-label { color: #aaa; font-size: 11px; }
.info-value { font-weight: bold; font-family: 'Courier New', monospace; }
.speed-value { color: #fa0; font-size: 14px; }
.gamma-value { color: #0ff; font-size: 14px; }

/* –°–≤–µ—Ç–ª—ã–π —Ä–µ–∂–∏–º */
body.light-mode { background: #fff; }
body.light-mode .btn { background: rgba(255,255,255,0.7); border:1px solid rgba(0,0,0,0.3); color:#000;}
body.light-mode .info-panel { background: rgba(255,255,255,0.9); color: #000; border:1px solid rgba(0,0,0,0.2);}
body.light-mode .info-label { color: #666; }
</style>
</head>
<body>
<canvas id="c"></canvas>

<div class="info-panel" id="infoPanel">
  <div class="info-item">
    <span class="info-label">Speed:</span>
    <span class="info-value speed-value" id="speedValue">0.000c</span>
  </div>
  <div class="info-item">
    <span class="info-label">Œ≥:</span>
    <span class="info-value gamma-value" id="gammaValue">1.000</span>
  </div>
</div>

<!-- –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
<div class="controls">
  <button class="btn" id="modeEuclid" title="Euclidean">E</button>
  <button class="btn" id="modeMink" title="Minkowski">M</button>
  <button class="btn" id="modeSphere" title="Spherical">S</button>
  <button class="btn" id="negBtn" title="Invert">‚òÄ</button>
  <button class="btn" id="zoomReset" title="Reset scale">‚Üª</button>
  <button class="btn" id="fullscreen" title="Fullscreen">‚õ∂</button>
</div>

<script>
const canvas = document.getElementById("c");
const ctx = canvas.getContext("2d");
let width, height;

let scale = 0.3;
let offsetX = 0, offsetY = 0;
let angle = 0;
let dragging = false;
let lastX = 0;
let darkMode = true;

// –ì–µ–æ–º–µ—Ç—Ä–∏—è: 'euclid', 'minkowski', 'sphere'
let geomMode = 'euclid';

// –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ª–∏–Ω–∏–π
const vertLineLength = 3000;
const numLines = 21;
const secondsPerSide = 10;
const lineSpacing = vertLineLength / (numLines - 1);
const halfSpacing = lineSpacing / 2;
const smallSpacing = lineSpacing / 10;

// –¶–µ–ª—å Œ≥
const TARGET_GAMMA = 1e6;
const TARGET_V = Math.sqrt(1 - 1/(TARGET_GAMMA*TARGET_GAMMA));
const MAX_ANGLE = Math.asin(TARGET_V);

// --- –ò–ù–¢–ï–†–ê–ö–¢–ò–í–ù–û–°–¢–¨ ---
canvas.addEventListener('pointerdown', e => { dragging = true; lastX = e.clientX; });
canvas.addEventListener('pointermove', e => { 
  if(dragging){
    angle += (e.clientX - lastX) * 0.01;
    lastX = e.clientX;
  }
});
canvas.addEventListener('pointerup', () => dragging=false);
canvas.addEventListener('pointerleave', () => dragging=false);
canvas.addEventListener('wheel', e=>{
  e.preventDefault();
  const zoomFactor = 1.1;
  const mouseX = e.clientX;
  const mouseY = e.clientY;
  const worldX = (mouseX - offsetX)/scale;
  const worldY = (mouseY - offsetY)/scale;
  scale *= (e.deltaY<0? zoomFactor:1/zoomFactor);
  scale = Math.max(0.1, Math.min(5, scale));
  offsetX = mouseX - worldX*scale;
  offsetY = mouseY - worldY*scale;
});

// --- –ö–ù–û–ü–ö–ò ---
document.getElementById('negBtn').addEventListener('click', ()=>{
  darkMode = !darkMode;
  document.body.classList.toggle('light-mode', !darkMode);
  document.getElementById('negBtn').textContent = darkMode?'‚òÄ':'üåô';
});
document.getElementById('zoomReset').addEventListener('click', ()=>{
  scale = 0.3;
  offsetX = width/2;
  offsetY = height/2;
});
document.getElementById('fullscreen').addEventListener('click', ()=>{
  if(!document.fullscreenElement) document.documentElement.requestFullscreen();
  else document.exitFullscreen();
});

// –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≥–µ–æ–º–µ—Ç—Ä–∏–π
document.getElementById('modeEuclid').addEventListener('click',()=>geomMode='euclid');
document.getElementById('modeMink').addEventListener('click',()=>geomMode='minkowski');
document.getElementById('modeSphere').addEventListener('click',()=>geomMode='sphere');

// --- –§–£–ù–ö–¶–ò–ò –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï ---
function toScreen(x,y){
  return {x:x*scale + offsetX, y:y*scale + offsetY};
}
function getColor(darkColor, lightColor){ return darkMode?darkColor:lightColor; }
function drawLine(x1,y1,x2,y2,dColor,lColor,w){
  const p1 = toScreen(x1,y1); const p2=toScreen(x2,y2);
  ctx.strokeStyle = getColor(dColor,lColor);
  ctx.lineWidth = w;
  ctx.beginPath(); ctx.moveTo(p1.x,p1.y); ctx.lineTo(p2.x,p2.y); ctx.stroke();
}
function drawPoint(px,py,radius,dColor,lColor){
  const p = toScreen(px,py);
  ctx.fillStyle = getColor(dColor,lColor);
  ctx.beginPath(); ctx.arc(p.x,p.y,radius,0,Math.PI*2); ctx.fill();
}
function drawText(text,px,py,dColor,lColor,fs=10,align="center"){
  if(scale<0.5) return;
  const p=toScreen(px,py);
  ctx.font = `${fs}px Arial`;
  ctx.fillStyle = getColor(dColor,lColor);
  ctx.textAlign=align;
  ctx.textBaseline="middle";
  ctx.fillText(text,p.x,p.y);
}

// --- –û–ë–ù–û–í–õ–ï–ù–ò–ï –ò–ù–§–û ---
function updateInfo(){
  let v = Math.sin(angle);
  if(Math.abs(v)>0.999999) v = TARGET_V*(v<0?-1:1);
  let gamma = 1/Math.sqrt(1-v*v);
  if(Math.abs(v)>0.999999) gamma = TARGET_GAMMA;
  let vStr = Math.abs(v)<0.001?"0.000c":Math.abs(v).toFixed(3)+"c"; if(v<0)vStr='-'+vStr;
  document.getElementById('speedValue').textContent = vStr;
  document.getElementById('gammaValue').textContent = gamma.toFixed(3);
  const speedValue = document.getElementById('speedValue');
  const absV = Math.abs(v);
  if(absV<0.3) speedValue.style.color = darkMode?'#0f0':'#080';
  else if(absV<0.7) speedValue.style.color = darkMode?'#ff0':'#880';
  else if(absV<0.95) speedValue.style.color = darkMode?'#f80':'#c60';
  else speedValue.style.color = darkMode?'#f00':'#c00';
}

// --- –†–ò–°–û–í–ê–ù–ò–ï ---
function draw(){
  ctx.fillStyle = darkMode?"#000833":"#fff";
  ctx.fillRect(0,0,width,height);
  
  if(geomMode==='euclid') drawEuclid();
  else if(geomMode==='minkowski') drawMinkowski();
  else if(geomMode==='sphere') drawSphere();
  
  updateInfo();
  requestAnimationFrame(draw);
}

// --- –ï–í–ö–õ–ò–î–û–í–ê–Ø ---
function drawEuclid(){
  const cx=0, cy=0;
  const cosA=Math.cos(angle), sinA=Math.sin(angle);

  drawLine(-vertLineLength,cy,vertLineLength,cy,"#0ff","#08f",1);

  const ctX0 = cx - sinA*vertLineLength/2;
  const ctY0 = cy - cosA*vertLineLength/2;
  const ctX1 = cx + sinA*vertLineLength/2;
  const ctY1 = cy + cosA*vertLineLength/2;
  const xX0 = cx - cosA*vertLineLength/2;
  const xY0 = cy + sinA*vertLineLength/2;
  const xX1 = cx + cosA*vertLineLength/2;
  const xY1 = cy - sinA*vertLineLength/2;
  drawLine(ctX0,ctY0,ctX1,ctY1,"#0ff","#08f",1);
  drawLine(xX0,xY0,xX1,xY1,"#888","#666",1);

  const ctDirX=ctX1-ctX0, ctDirY=ctY1-ctY0;
  const ctLen=Math.sqrt(ctDirX*ctDirX+ctDirY*ctDirY);
  const ctUnitX = ctDirX/ctLen, ctUnitY = ctDirY/ctLen;
  const ctPerpX=-ctUnitY, ctPerpY=ctUnitX;

  // –û—Ç–º–µ—Ç–∫–∏
  for(let sec=1; sec<=secondsPerSide; sec++){
    const d = sec*lineSpacing;
    drawMarkLine(ctUnitX,ctUnitY,ctPerpX,ctPerpY,d);
    drawMarkLine(ctUnitX,ctUnitY,ctPerpX,ctPerpY,-d);
  }

  // –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–µ –ª–∏–Ω–∏–∏
  for(let i=-10;i<=10;i++){
    const t=i/10;
    const px=xX0+(xX1-xX0)*(0.5+t/2);
    const py=xY0+(xY1-xY0)*(0.5+t/2);
    drawLine(px,py-vertLineLength/2,px,py+vertLineLength/2,"#888","#666",1);
  }

  drawPoint(cx,cy,4,"#fff","#000");
}

// --- –ú–ò–ù–ö–û–í–°–ö–û–ì–û ---
function drawMinkowski(){
  const cx=0, cy=0;
  const baseLength=vertLineLength/1.5;
  // –ü—Ä–æ—Å—Ç–∞—è —Ä–µ–ª—è—Ç–∏–≤–∏—Å—Ç—Å–∫–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞: –Ω–∞–∫–ª–æ–Ω –æ—Å–∏ t‚Ä≤
  for(let i=-secondsPerSide;i<=secondsPerSide;i++){
    const t = i*lineSpacing/2;
    drawLine(-baseLength,t,baseLength,t,"#0ff","#08f",1);
  }
  // –û–±—ä–µ–∫—Ç—ã: –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–µ –º–∏—Ä–æ–≤—ã–µ –ª–∏–Ω–∏–∏
  for(let i=-10;i<=10;i++){
    const x = i*lineSpacing/2;
    drawLine(x,-baseLength,x,baseLength,"#888","#666",1);
  }
  drawPoint(cx,cy,4,"#fff","#000");
}

// --- –°–§–ï–†–ò–ß–ï–°–ö–ê–Ø ---
function drawSphere(){
  const cx=0, cy=0;
  const radius = vertLineLength/2;
  ctx.strokeStyle = getColor("#0ff","#08f");
  ctx.lineWidth = 1;
  ctx.beginPath();
  ctx.arc(cx*scale+offsetX,cy*scale+offsetY,radius*scale,0,Math.PI*2);
  ctx.stroke();

  // –†–∞–¥–∏–∞–ª—å–Ω—ã–µ –ª–∏–Ω–∏–∏
  for(let i=0;i<numLines;i++){
    const angleLine = (i/numLines)*Math.PI*2;
    const x = Math.cos(angleLine)*radius;
    const y = Math.sin(angleLine)*radius;
    drawLine(cx,cy,x,y,"#888","#666",1);
  }

  drawPoint(cx,cy,4,"#fff","#000");
}

// --- –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–û–ï ---
function drawMarkLine(unitX,unitY,perpX,perpY,d){
  const x1=unitX*d, y1=unitY*d;
  drawMark(x1,y1,perpX,perpY,14,"#0ff","#08f",1.5);
}

function drawMark(px,py,dirX,dirY,length,dColor,lColor,width){
  const p1 = toScreen(px+dirX*length/2, py+dirY*length/2);
  const p2 = toScreen(px-dirX*length/2, py-dirY*length/2);
  ctx.strokeStyle = getColor(dColor,lColor);
  ctx.lineWidth = width;
  ctx.beginPath();
  ctx.moveTo(p1.x,p1.y);
  ctx.lineTo(p2.x,p2.y);
  ctx.stroke();
}

// --- –†–ê–ó–ú–ï–† ---
function resize(){
  width=canvas.width=window.innerWidth;
  height=canvas.height=window.innerHeight;
  offsetX = width/2;
  offsetY = height/2;
}
window.addEventListener("resize", resize);
resize();

// --- –ó–ê–ü–£–°–ö ---
draw();
updateInfo();
</script>
</body>
</html>
