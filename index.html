<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>SR Visualization</title>
<style>
  body { margin:0; background:#111; overflow:hidden; touch-action: none; font-family: Arial, sans-serif; }
  canvas { display:block; }
  /* –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è */
  .controls {
    position: absolute;
    top: 10px;
    right: 10px;
    display: flex;
    gap: 8px;
    z-index: 100;
    flex-wrap: wrap;
    justify-content: flex-end;
    max-width: 200px;
  }
  .btn {
    width: 40px;
    height: 40px;
    border-radius: 5px;
    background: rgba(0,0,0,0.7);
    border: 1px solid rgba(255,255,255,0.3);
    color: white;
    font-size: 20px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    user-select: none;
    transition: all 0.2s;
  }
  .btn:hover {
    background: rgba(50,50,50,0.9);
  }
  .btn:active {
    transform: scale(0.95);
  }
  /* –ü–∞–Ω–µ–ª—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ */
  .info-panel {
    position: absolute;
    top: 10px;
    left: 10px;
    background: rgba(0,0,0,0.7);
    color: white;
    padding: 10px 15px;
    border-radius: 5px;
    font-size: 14px;
    border: 1px solid rgba(255,255,255,0.2);
    z-index: 100;
    min-width: 200px;
  }
  .info-item {
    margin: 5px 0;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  .info-label {
    color: #aaa;
  }
  .info-value {
    font-weight: bold;
    font-family: 'Courier New', monospace;
  }
  .speed-value {
    color: #fa0;
    font-size: 16px;
  }
  .gamma-value {
    color: #0ff;
    font-size: 16px;
  }
  
  /* –°—Ç–∏–ª–∏ –¥–ª—è —Å–≤–µ—Ç–ª–æ–≥–æ —Ä–µ–∂–∏–º–∞ */
  body.light-mode {
    background: #fff;
  }
  body.light-mode .btn {
    background: rgba(255,255,255,0.7);
    border: 1px solid rgba(0,0,0,0.3);
    color: #000;
  }
  body.light-mode .info-panel {
    background: rgba(255,255,255,0.9);
    color: #000;
    border: 1px solid rgba(0,0,0,0.2);
  }
  body.light-mode .info-label {
    color: #666;
  }
</style>
</head>
<body>
<canvas id="c"></canvas>

<!-- –ü–∞–Ω–µ–ª—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ -->
<div class="info-panel" id="infoPanel">
  <div class="info-item">
    <span class="info-label">Speed:</span>
    <span class="info-value speed-value" id="speedValue">0.000c</span>
  </div>
  <div class="info-item">
    <span class="info-label">Œ≥:</span>
    <span class="info-value gamma-value" id="gammaValue">1.000</span>
  </div>
</div>

<!-- –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
<div class="controls">
  <button class="btn" id="negBtn" title="Negative/Invert">‚òÄ</button>
  <button class="btn" id="zoomIn" title="Zoom in">+</button>
  <button class="btn" id="zoomOut" title="Zoom out">-</button>
  <button class="btn" id="zoomReset" title="Reset scale">‚Üª</button>
  <button class="btn" id="fullscreen" title="Fullscreen mode">‚õ∂</button>
</div>

<script>
const canvas = document.getElementById("c");
const ctx = canvas.getContext("2d");

// –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏
let angle = 0; // —É–≥–æ–ª –ø–æ–≤–æ—Ä–æ—Ç–∞ –∫—Ä–µ—Å—Ç–∞
let dragging = false;
let lastX = 0;
let scale = 0.3;
let offsetX = 0, offsetY = 0;
let darkMode = true;

// –ü–ê–†–ê–ú–ï–¢–†–´ (—É–≤–µ–ª–∏—á–µ–Ω–Ω—ã–µ)
const numLines = 21; // 10 —Å –∫–∞–∂–¥–æ–π —Å—Ç–æ—Ä–æ–Ω—ã + —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è = 21
const secondsPerSide = 10; // –±—ã–ª–æ 5, —Ç–µ–ø–µ—Ä—å 10
const vertLineLength = 3000;

// –¢ARGET GAMMA = 1,000,000
const TARGET_GAMMA = 1000000.000;
// –í—ã—á–∏—Å–ª—è–µ–º —Å–∫–æ—Ä–æ—Å—Ç—å –¥–ª—è Œ≥ = 1,000,000
const TARGET_V = Math.sqrt(1 - 1/(TARGET_GAMMA * TARGET_GAMMA));
// –í—ã—á–∏—Å–ª—è–µ–º —É–≥–æ–ª –¥–ª—è —ç—Ç–æ–π —Å–∫–æ—Ä–æ—Å—Ç–∏ (v/c = sin(angle))
const MAX_ANGLE = Math.asin(TARGET_V);

console.log(`Target Œ≥: ${TARGET_GAMMA}`);
console.log(`Target v/c: ${TARGET_V}`);
console.log(`Max angle (rad): ${MAX_ANGLE}`);
console.log(`Max angle (deg): ${MAX_ANGLE * 180/Math.PI}`);

// –ú–£–õ–¨–¢–ò–¢–ê–ß –ü–ï–†–ï–ú–ï–ù–ù–´–ï
let touchStartDistance = null;
let touchStartAngle = null;
let touchStartScale = 0.3;
let touchStartRotation = 0;
let initialTouches = [];

// –†–ê–°–ß–ï–¢ –†–ê–°–°–¢–û–Ø–ù–ò–ô
const lineSpacing = vertLineLength / (numLines - 1);
const halfSpacing = lineSpacing / 2;
const smallSpacing = lineSpacing / 10;

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è –º–µ–∂–¥—É –¥–≤—É–º—è —Ç–æ—á–∫–∞–º–∏ –∫–∞—Å–∞–Ω–∏—è
function getTouchDistance(touches) {
  const dx = touches[0].clientX - touches[1].clientX;
  const dy = touches[0].clientY - touches[1].clientY;
  return Math.sqrt(dx * dx + dy * dy);
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è —É–≥–ª–∞ –º–µ–∂–¥—É –¥–≤—É–º—è —Ç–æ—á–∫–∞–º–∏ –∫–∞—Å–∞–Ω–∏—è
function getTouchAngle(touches) {
  const dx = touches[0].clientX - touches[1].clientX;
  const dy = touches[0].clientY - touches[1].clientY;
  return Math.atan2(dy, dx);
}

// –û–ë–†–ê–ë–û–¢–ö–ê –ö–ê–°–ê–ù–ò–ô (–º—É–ª—å—Ç–∏—Ç–∞—á)
canvas.addEventListener('touchstart', (e) => {
  e.preventDefault();
  
  if (e.touches.length === 2) {
    // –ù–∞—á–∞–ª–æ –∂–µ—Å—Ç–∞ –¥–≤—É–º—è –ø–∞–ª—å—Ü–∞–º–∏
    touchStartDistance = getTouchDistance(e.touches);
    touchStartAngle = getTouchAngle(e.touches);
    touchStartScale = scale;
    touchStartRotation = angle;
    initialTouches = Array.from(e.touches);
  } else if (e.touches.length === 1) {
    // –ù–∞—á–∞–ª–æ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è –æ–¥–Ω–∏–º –ø–∞–ª—å—Ü–µ–º
    dragging = true;
    lastX = e.touches[0].clientX;
  }
}, { passive: false });

canvas.addEventListener('touchmove', (e) => {
  e.preventDefault();
  
  if (e.touches.length === 2 && touchStartDistance !== null && touchStartDistance > 0) {
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∂–µ—Å—Ç–∞ –¥–≤—É–º—è –ø–∞–ª—å—Ü–∞–º–∏
    const currentDistance = getTouchDistance(e.touches);
    const currentAngle = getTouchAngle(e.touches);
    
    // Pinch-to-zoom
    if (touchStartDistance > 0) {
      const zoomFactor = currentDistance / touchStartDistance;
      let newScale = touchStartScale * zoomFactor;
      scale = Math.max(0.1, Math.min(5, newScale));
    }
    
    // –î–≤—É—Ö–ø–∞–ª—å—Ü–µ–≤—ã–π –ø–æ–≤–æ—Ä–æ—Ç
    if (touchStartAngle !== null) {
      const angleDelta = currentAngle - touchStartAngle;
      let newAngle = touchStartRotation + angleDelta * 0.8; // –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –¥–ª—è –ø–ª–∞–≤–Ω–æ—Å—Ç–∏
      
      // –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —É–≥–ª–∞
      newAngle = Math.max(-MAX_ANGLE, Math.min(MAX_ANGLE, newAngle));
      angle = newAngle;
    }
    
    updateInfo();
  } else if (e.touches.length === 1 && dragging) {
    // –ü–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ –æ–¥–Ω–∏–º –ø–∞–ª—å—Ü–µ–º
    const dx = e.touches[0].clientX - lastX;
    // –†–ï–í–ï–†–°: –º–µ–Ω—è–µ–º –∑–Ω–∞–∫ –Ω–∞ –ø—Ä–æ—Ç–∏–≤–æ–ø–æ–ª–æ–∂–Ω—ã–π
    let newAngle = angle + dx * 0.01;
    
    // –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —É–≥–ª–∞
    newAngle = Math.max(-MAX_ANGLE, Math.min(MAX_ANGLE, newAngle));
    angle = newAngle;
    
    lastX = e.touches[0].clientX;
    updateInfo();
  }
}, { passive: false });

canvas.addEventListener('touchend', (e) => {
  dragging = false;
  if (e.touches.length < 2) {
    touchStartDistance = null;
    touchStartAngle = null;
    initialTouches = [];
  }
});

// –û–ë–†–ê–ë–û–¢–ö–ê –ú–´–®–ò
canvas.addEventListener("pointerdown", e => {
  dragging = true;
  lastX = e.clientX;
});

canvas.addEventListener("pointermove", e => {
  if(dragging){
    const dx = e.clientX - lastX;
    // –†–ï–í–ï–†–°: –º–µ–Ω—è–µ–º –∑–Ω–∞–∫ –Ω–∞ –ø—Ä–æ—Ç–∏–≤–æ–ø–æ–ª–æ–∂–Ω—ã–π
    let newAngle = angle + dx * 0.01;
    
    // –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —É–≥–ª–∞
    newAngle = Math.max(-MAX_ANGLE, Math.min(MAX_ANGLE, newAngle));
    angle = newAngle;
    
    lastX = e.clientX;
    updateInfo();
  }
});

canvas.addEventListener("pointerup", e => dragging = false);
canvas.addEventListener("pointerleave", e => dragging = false);

// –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–ª–µ—Å–æ–º –º—ã—à–∏
canvas.addEventListener("wheel", e => {
  e.preventDefault();
  const zoomFactor = 1.1;
  const rect = canvas.getBoundingClientRect();
  const mouseX = e.clientX - rect.left;
  const mouseY = e.clientY - rect.top;
  
  const worldX = (mouseX - offsetX) / scale;
  const worldY = (mouseY - offsetY) / scale;
  
  if (e.deltaY < 0) {
    scale *= zoomFactor;
  } else {
    scale /= zoomFactor;
  }
  
  scale = Math.max(0.1, Math.min(5, scale));
  
  offsetX = mouseX - worldX * scale;
  offsetY = mouseY - worldY * scale;
});

// –ö–Ω–æ–ø–∫–∞ –Ω–µ–≥–∞—Ç–∏–≤–∞/—Å–≤–µ—Ç–ª–æ–≥–æ —Ä–µ–∂–∏–º–∞
document.getElementById('negBtn').addEventListener('click', () => {
  darkMode = !darkMode;
  document.body.classList.toggle('light-mode', !darkMode);
  document.getElementById('negBtn').textContent = darkMode ? '‚òÄ' : 'üåô';
});

// –ö–Ω–æ–ø–∫–∏ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è
document.getElementById('zoomIn').addEventListener('click', () => {
  scale = Math.min(5, scale * 1.2);
  offsetX = canvas.width/2;
  offsetY = canvas.height/2;
});

document.getElementById('zoomOut').addEventListener('click', () => {
  scale = Math.max(0.1, scale / 1.
