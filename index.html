<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>–°–¢–û –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è</title>
<style>
  body { margin:0; background:#111; overflow:hidden; touch-action: none; font-family: Arial, sans-serif; }
  canvas { display:block; }
  /* –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è */
  .controls {
    position: absolute;
    top: 10px;
    right: 10px;
    display: flex;
    gap: 8px;
    z-index: 100;
    flex-wrap: wrap;
    justify-content: flex-end;
    max-width: 200px;
  }
  .btn {
    width: 40px;
    height: 40px;
    border-radius: 5px;
    background: rgba(0,0,0,0.7);
    border: 1px solid rgba(255,255,255,0.3);
    color: white;
    font-size: 20px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    user-select: none;
    transition: all 0.2s;
  }
  .btn:hover {
    background: rgba(50,50,50,0.9);
  }
  .btn:active {
    transform: scale(0.95);
  }
  /* –ü–∞–Ω–µ–ª—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ */
  .info-panel {
    position: absolute;
    top: 10px;
    left: 10px;
    background: rgba(0,0,0,0.7);
    color: white;
    padding: 10px 15px;
    border-radius: 5px;
    font-size: 14px;
    border: 1px solid rgba(255,255,255,0.2);
    z-index: 100;
    min-width: 200px;
  }
  .info-item {
    margin: 5px 0;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  .info-label {
    color: #aaa;
  }
  .info-value {
    font-weight: bold;
    font-family: 'Courier New', monospace;
  }
  .speed-value {
    color: #fa0;
    font-size: 16px;
  }
  .gamma-value {
    color: #0ff;
  }
  .rapidity-value {
    color: #8f8;
  }
  
  /* –°—Ç–∏–ª–∏ –¥–ª—è —Å–≤–µ—Ç–ª–æ–≥–æ —Ä–µ–∂–∏–º–∞ */
  body.light-mode {
    background: #fff;
  }
  body.light-mode .btn {
    background: rgba(255,255,255,0.7);
    border: 1px solid rgba(0,0,0,0.3);
    color: #000;
  }
  body.light-mode .info-panel {
    background: rgba(255,255,255,0.9);
    color: #000;
    border: 1px solid rgba(0,0,0,0.2);
  }
  body.light-mode .info-label {
    color: #666;
  }
</style>
</head>
<body>
<canvas id="c"></canvas>

<!-- –ü–∞–Ω–µ–ª—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ -->
<div class="info-panel" id="infoPanel">
  <div class="info-item">
    <span class="info-label">v/c:</span>
    <span class="info-value speed-value" id="speedValue">0.00000000</span>
  </div>
  <div class="info-item">
    <span class="info-label">Œ≥:</span>
    <span class="info-value gamma-value" id="gammaValue">1.000</span>
  </div>
  <div class="info-item">
    <span class="info-label">–ë—ã—Å—Ç—Ä–æ—Ç–∞:</span>
    <span class="info-value rapidity-value" id="rapidityValue">0.000</span>
  </div>
</div>

<!-- –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
<div class="controls">
  <button class="btn" id="negBtn" title="–ù–µ–≥–∞—Ç–∏–≤/–ò–Ω–≤–µ—Ä—Å–∏—è">‚òÄ</button>
  <button class="btn" id="zoomIn" title="–£–≤–µ–ª–∏—á–∏—Ç—å">+</button>
  <button class="btn" id="zoomOut" title="–£–º–µ–Ω—å—à–∏—Ç—å">-</button>
  <button class="btn" id="zoomReset" title="–°–±—Ä–æ—Å–∏—Ç—å –º–∞—Å—à—Ç–∞–±">‚Üª</button>
  <button class="btn" id="fullscreen" title="–ü–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º">‚õ∂</button>
</div>

<script>
const canvas = document.getElementById("c");
const ctx = canvas.getContext("2d");

let angle = 0; // —É–≥–æ–ª –≤—Ä–∞—â–µ–Ω–∏—è –∫—Ä–µ—Å—Ç–∞ –æ—Ç 0 –¥–æ 45 –≥—Ä–∞–¥—É—Å–æ–≤
let dragging = false;
let lastX = 0;
let scale = 1.0;
let offsetX = 0, offsetY = 0;
let darkMode = true;

// –ü–ê–†–ê–ú–ï–¢–†–´
const numLines = 11;           // 11 –ª–∏–Ω–∏–π (–ø–æ 5 —Å –∫–∞–∂–¥–æ–π —Å—Ç–æ—Ä–æ–Ω—ã + —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è)
const secondsPerSide = 5;      // ¬±5 —Å–µ–∫—É–Ω–¥ –æ—Ç —Ü–µ–Ω—Ç—Ä–∞
const vertLineLength = 1000;   // –¥–ª–∏–Ω–∞ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã—Ö –ª–∏–Ω–∏–π –∏ –∫—Ä–µ—Å—Ç–∞

// –†–ê–°–ß–ï–¢ –†–ê–°–°–¢–û–Ø–ù–ò–ô (1 —Å–≤–µ—Ç–æ–≤–∞—è —Å–µ–∫—É–Ω–¥–∞ = —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–º–∏ –ª–∏–Ω–∏—è–º–∏)
const lineSpacing = vertLineLength / (numLines - 1); // ~90.9px
const halfSpacing = lineSpacing / 2;                // 0.5 —Å–µ–∫—É–Ω–¥—ã
const smallSpacing = lineSpacing / 10;              // 0.1 —Å–µ–∫—É–Ω–¥—ã

// –§–ò–ó–ò–ß–ï–°–ö–ò–ï –ö–û–ù–°–¢–ê–ù–¢–´
const MAX_ANGLE = Math.PI / 4;  // 45 –≥—Ä–∞–¥—É—Å–æ–≤
const MAX_GAMMA = 1000000;      // –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ Œ≥

// drag
canvas.addEventListener("pointerdown", e => {
  dragging = true;
  lastX = e.clientX;
});

canvas.addEventListener("pointermove", e => {
  if(dragging){
    const dx = e.clientX - lastX;
    angle -= dx * 0.01;
    // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º —É–≥–æ–ª –¥–æ [0, œÄ/4]
    angle = Math.max(0, Math.min(MAX_ANGLE, angle));
    lastX = e.clientX;
    updateInfo();
  }
});

canvas.addEventListener("pointerup", e => dragging = false);
canvas.addEventListener("pointerleave", e => dragging = false);

// –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–ª–µ—Å–æ–º –º—ã—à–∏
canvas.addEventListener("wheel", e => {
  e.preventDefault();
  const zoomFactor = 1.1;
  const rect = canvas.getBoundingClientRect();
  const mouseX = e.clientX - rect.left;
  const mouseY = e.clientY - rect.top;
  
  const worldX = (mouseX - offsetX) / scale;
  const worldY = (mouseY - offsetY) / scale;
  
  if (e.deltaY < 0) {
    scale *= zoomFactor;
  } else {
    scale /= zoomFactor;
  }
  
  scale = Math.max(0.1, Math.min(5, scale));
  
  offsetX = canvas.width/2;
  offsetY = canvas.height/2;
});

// –ö–Ω–æ–ø–∫–∞ –Ω–µ–≥–∞—Ç–∏–≤–∞/—Å–≤–µ—Ç–ª–æ–≥–æ —Ä–µ–∂–∏–º–∞
document.getElementById('negBtn').addEventListener('click', () => {
  darkMode = !darkMode;
  document.body.classList.toggle('light-mode', !darkMode);
  document.getElementById('negBtn').textContent = darkMode ? '‚òÄ' : 'üåô';
});

// –ö–Ω–æ–ø–∫–∏ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è
document.getElementById('zoomIn').addEventListener('click', () => {
  scale = Math.min(5, scale * 1.2);
  offsetX = canvas.width/2;
  offsetY = canvas.height/2;
});

document.getElementById('zoomOut').addEventListener('click', () => {
  scale = Math.max(0.1, scale / 1.2);
  offsetX = canvas.width/2;
  offsetY = canvas.height/2;
});

document.getElementById('zoomReset').addEventListener('click', () => {
  scale = 1.0;
  offsetX = canvas.width/2;
  offsetY = canvas.height/2;
});

// –ü–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º
document.getElementById('fullscreen').addEventListener('click', () => {
  if (!document.fullscreenElement) {
    document.documentElement.requestFullscreen().catch(err => {
      console.error(`–û—à–∏–±–∫–∞ –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞: ${err.message}`);
    });
  } else {
    document.exitFullscreen();
  }
});

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
function updateInfo() {
  // –í—ã—á–∏—Å–ª—è–µ–º —Ñ–∏–∑–∏—á–µ—Å–∫–∏–µ –≤–µ–ª–∏—á–∏–Ω—ã
  // –í –°–¢–û: v/c = tan(Œ∏), –≥–¥–µ Œ∏ - —É–≥–æ–ª –Ω–∞–∫–ª–æ–Ω–∞ –æ—Å–µ–π –Ω–∞ –¥–∏–∞–≥—Ä–∞–º–º–µ –ú–∏–Ω–∫–æ–≤—Å–∫–æ–≥–æ
  const velocity = Math.tan(angle); // v/c
  const gamma = 1 / Math.sqrt(1 - velocity * velocity); // Œ≥ = 1/‚àö(1-v¬≤/c¬≤)
  const rapidity = Math.atanh(velocity); // –±—ã—Å—Ç—Ä–æ—Ç–∞ = atanh(v/c)
  
  // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º —Å–∫–æ—Ä–æ—Å—Ç—å: 8 –∑–Ω–∞–∫–æ–≤ –ø–æ—Å–ª–µ –∑–∞–ø—è—Ç–æ–π
  const velocityFormatted = velocity.toFixed(8);
  
  // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
  document.getElementById('speedValue').textContent = velocityFormatted;
  
  // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º Œ≥
  if (gamma > MAX_GAMMA) {
    document.getElementById('gammaValue').textContent = '1,000,000+';
    document.getElementById('gammaValue').style.color = darkMode ? '#f00' : '#c00';
  } else if (gamma >= 1000) {
    document.getElementById('gammaValue').textContent = Math.round(gamma).toLocaleString();
    document.getElementById('gammaValue').style.color = darkMode ? '#f80' : '#a60';
  } else if (gamma >= 100) {
    document.getElementById('gammaValue').textContent = gamma.toFixed(1);
    document.getElementById('gammaValue').style.color = darkMode ? '#ff0' : '#880';
  } else if (gamma >= 10) {
    document.getElementById('gammaValue').textContent = gamma.toFixed(2);
    document.getElementById('gammaValue').style.color = darkMode ? '#af0' : '#6a0';
  } else {
    document.getElementById('gammaValue').textContent = gamma.toFixed(3);
    document.getElementById('gammaValue').style.color = darkMode ? '#0ff' : '#08f';
  }
  
  // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –±—ã—Å—Ç—Ä–æ—Ç—É
  document.getElementById('rapidityValue').textContent = rapidity.toFixed(6);
  
  // –¶–≤–µ—Ç —Å–∫–æ—Ä–æ—Å—Ç–∏
  const speedValue = document.getElementById('speedValue');
  if (velocity < 0.3) {
    speedValue.style.color = darkMode ? '#0f0' : '#080';
  } else if (velocity < 0.7) {
    speedValue.style.color = darkMode ? '#ff0' : '#880';
  } else if (velocity < 0.95) {
    speedValue.style.color = darkMode ? '#f80' : '#c60';
  } else if (velocity < 0.999) {
    speedValue.style.color = darkMode ? '#f08' : '#a06';
  } else {
    speedValue.style.color = darkMode ? '#f00' : '#c00';
  }
}

function resize() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
window.addEventListener("resize", resize);
resize();

function draw() {
  // –û—á–∏—Å—Ç–∫–∞ —Å —É—á—ë—Ç–æ–º —Ä–µ–∂–∏–º–∞
  if (darkMode) {
    ctx.fillStyle = "#111";
  } else {
    ctx.fillStyle = "#fff";
  }
  ctx.fillRect(0, 0, canvas.width, canvas.height);
  
  const cx = canvas.width / 2;
  const cy = canvas.height / 2;
  
  const cosA = Math.cos(angle);
  const sinA = Math.sin(angle);

  // --- –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–∞—è –æ—Å—å (–ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞) ---
  ctx.strokeStyle = darkMode ? "#888" : "#666";
  ctx.lineWidth = 2;
  ctx.beginPath();
  ctx.moveTo(0, cy);
  ctx.lineTo(canvas.width, cy);
  ctx.stroke();

  // –∫—Ä–µ—Å—Ç ct‚Ä≤ + x‚Ä≤ (–≤ —Ü–µ–Ω—Ç—Ä–µ)
  const ctX0 = cx - sinA * vertLineLength/2;
  const ctY0 = cy - cosA * vertLineLength/2;
  const ctX1 = cx + sinA * vertLineLength/2;
  const ctY1 = cy + cosA * vertLineLength/2;

  const xX0 = cx - cosA * vertLineLength/2;
  const xY0 = cy + sinA * vertLineLength/2;
  const xX1 = cx + cosA * vertLineLength/2;
  const xY1 = cy - sinA * vertLineLength/2;

  // ct‚Ä≤ (–≥–æ–ª—É–±–∞—è –æ—Å—å –≤—Ä–µ–º–µ–Ω–∏)
  ctx.strokeStyle = darkMode ? "#0ff" : "#08f";
  ctx.lineWidth = 1;
  ctx.beginPath();
  ctx.moveTo(ctX0, ctY0);
  ctx.lineTo(ctX1, ctY1);
  ctx.stroke();

  // x‚Ä≤ (–æ—Ä–∞–Ω–∂–µ–≤–∞—è –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ–Ω–Ω–∞—è –æ—Å—å)
  ctx.strokeStyle = darkMode ? "#fa0" : "#c60";
  ctx.lineWidth = 1;
  ctx.beginPath();
  ctx.moveTo(xX0, xY0);
  ctx.lineTo(xX1, xY1);
  ctx.stroke();

  // –í–ï–†–¢–ò–ö–ê–õ–¨–ù–´–ï –õ–ò–ù–ò–ò, –ü–û–î–í–ï–®–ï–ù–ù–´–ï –ö x‚Ä≤ (–ª–∏–Ω–∏–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ—Å—Ç–∏ –≤ –¥–≤–∏–∂—É—â–µ–π—Å—è —Å–∏—Å—Ç–µ–º–µ)
  ctx.strokeStyle = darkMode ? "#880" : "#660";
  ctx.lineWidth = 1;
  
  // –û—Ç–º–µ—Ç–∫–∏ –Ω–∞ —Å–∏–Ω–µ–π –æ—Å–∏ (ct‚Ä≤)
  ctx.strokeStyle = darkMode ? "#088" : "#066";
  ctx.lineWidth = 0.8;
  const ctMarks = Math.floor(vertLineLength / 2 / lineSpacing);
  for(let j = 1; j <= ctMarks; j++) {
    const markX1 = cx + sinA * j * lineSpacing;
    const markY1 = cy + cosA * j * lineSpacing;
    const perpX = -cosA;
    const perpY = sinA;
    
    ctx.beginPath();
    ctx.moveTo(markX1 - perpX * 7, markY1 - perpY * 7);
    ctx.lineTo(markX1 + perpX * 7, markY1 + perpY * 7);
    ctx.stroke();
    
    const markX2 = cx - sinA * j * lineSpacing;
    const markY2 = cy - cosA * j * lineSpacing;
    
    ctx.beginPath();
    ctx.moveTo(markX2 - perpX * 7, markY2 - perpY * 7);
    ctx.lineTo(markX2 + perpX * 7, markY2 + perpY * 7);
    ctx.stroke();
  }

  // –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–µ –ª–∏–Ω–∏–∏ –∏ –∏—Ö –æ—Ç–º–µ—Ç–∫–∏
  for(let i = -5; i <= 5; i++) {
    const t = i / 5;
    const px = xX0 + (xX1 - xX0) * (0.5 + t/2);
    const py = xY0 + (xY1 - xY0) * (0.5 + t/2);
    
    // –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–∞—è –ª–∏–Ω–∏—è (–ø–µ—Ä–ø–µ–Ω–¥–∏–∫—É–ª—è—Ä–Ω–æ x‚Ä≤)
    ctx.strokeStyle = darkMode ? "#880" : "#660";
    ctx.lineWidth = 1;
    ctx.beginPath();
    ctx.moveTo(px - sinA * vertLineLength/2, py - cosA * vertLineLength/2);
    ctx.lineTo(px + sinA * vertLineLength/2, py + cosA * vertLineLength/2);
    ctx.stroke();
    
    // –ë–æ–ª—å—à–∏–µ –æ—Ç–º–µ—Ç–∫–∏ (1.0 —Å–µ–∫—É–Ω–¥—ã)
    ctx.strokeStyle = darkMode ? "#aa0" : "#880";
    ctx.lineWidth = 0.8;
    for(let j = 1; j <= secondsPerSide; j++) {
      const upX = px - sinA * j * lineSpacing;
      const upY = py - cosA * j * lineSpacing;
      const markDx = cosA;
      const markDy = sinA;
      
      ctx.beginPath();
      ctx.moveTo(upX - markDx * 6, upY - markDy * 6);
      ctx.lineTo(upX + markDx * 6, upY + markDy * 6);
      ctx.stroke();
      
      const downX = px + sinA * j * lineSpacing;
      const downY = py + cosA * j * lineSpacing;
      
      ctx.beginPath();
      ctx.moveTo(downX - markDx * 6, downY - markDy * 6);
      ctx.lineTo(downX + markDx * 6, downY + markDy * 6);
      ctx.stroke();
    }
    
    // –û—Ç–º–µ—Ç–∫–∏ 0.5 —Å–µ–∫—É–Ω–¥—ã
    ctx.setLineDash([3, 2]);
    ctx.strokeStyle = darkMode ? "#990" : "#770";
    ctx.lineWidth = 0.6;
    for(let j = 1; j <= secondsPerSide * 2; j++) {
      if (j % 2 === 0) continue; // –ø—Ä–æ–ø—É—Å–∫–∞–µ–º —Ü–µ–ª—ã–µ —Å–µ–∫—É–Ω–¥—ã
      
      const distance = j * halfSpacing;
      const upX = px - sinA * distance;
      const upY = py - cosA * distance;
      const markDx = cosA;
      const markDy = sinA;
      
      ctx.beginPath();
      ctx.moveTo(upX - markDx * 5, upY - markDy * 5);
      ctx.lineTo(upX + markDx * 5, upY + markDy * 5);
      ctx.stroke();
      
      const downX = px + sinA * distance;
      const downY = py + cosA * distance;
      
      ctx.beginPath();
      ctx.moveTo(downX - markDx * 5, downY - markDy * 5);
      ctx.lineTo(downX + markDx * 5, downY + markDy * 5);
      ctx.stroke();
    }
    ctx.setLineDash([]);
    
    // –ú–µ–ª–∫–∏–µ –æ—Ç–º–µ—Ç–∫–∏ 0.1 —Å–µ–∫—É–Ω–¥—ã
    ctx.fillStyle = darkMode ? "#770" : "#550";
    for(let j = 1; j <= secondsPerSide * 10; j++) {
      if (j % 5 === 0) continue; // –ø—Ä–æ–ø—É—Å–∫–∞–µ–º 0.5 –∏ 1.0 —Å–µ–∫—É–Ω–¥—ã
      
      const distance = j * smallSpacing;
      const upX = px - sinA * distance;
      const upY = py - cosA * distance;
      
      ctx.beginPath();
      ctx.arc(upX, upY, 1.5, 0, Math.PI * 2);
      ctx.fill();
      
      const downX = px + sinA * distance;
      const downY = py + cosA * distance;
      
      ctx.beginPath();
      ctx.arc(downX, downY, 1.5, 0, Math.PI * 2);
      ctx.fill();
    }
  }

  // –¶–µ–Ω—Ç—Ä –∫—Ä–µ—Å—Ç–∞
  ctx.fillStyle = darkMode ? "#fff" : "#000";
  ctx.beginPath();
  ctx.arc(cx, cy, 4, 0, Math.PI * 2);
  ctx.fill();

  requestAnimationFrame(draw);
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
resize();
updateInfo();
draw();
</script>
</body>
  </html>
